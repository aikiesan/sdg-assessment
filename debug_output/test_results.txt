============================= test session starts =============================
platform win32 -- Python 3.10.9, pytest-8.3.5, pluggy-1.5.0 -- Z:\sdg_assessment\venv\Scripts\python.exe
cachedir: .pytest_cache
rootdir: z:\sdg_assessment
plugins: cov-6.1.1, flask-1.2.0
collecting ... collected 27 items

tests/test_api.py::test_api_get_projects_unauthenticated SKIPPED (AP...) [  3%]
tests/test_api.py::test_api_get_projects_authenticated SKIPPED (Toke...) [  7%]
tests/test_assessments.py::test_assessment_creation PASSED               [ 11%]
tests/test_assessments.py::test_accessing_results_page_directly PASSED   [ 14%]
tests/test_assessments.py::test_assessment_submission_and_results PASSED [ 18%]
tests/test_assessments.py::test_edit_assessment_get SKIPPED (Edit as...) [ 22%]
tests/test_assessments.py::test_edit_assessment_post SKIPPED (Edit a...) [ 25%]
tests/test_assessments.py::test_delete_assessment SKIPPED (Delete as...) [ 29%]
tests/test_assessments.py::test_edit_assessment_unauthorized PASSED      [ 33%]
tests/test_assessments.py::test_view_nonexistent_assessment PASSED       [ 37%]
tests/test_assessments.py::test_create_assessment_invalid_data SKIPPED   [ 40%]
tests/test_auth.py::test_login_logout PASSED                             [ 44%]
tests/test_auth.py::test_login_invalid_password PASSED                   [ 48%]
tests/test_basic.py::test_index_page PASSED                              [ 51%]
tests/test_basic.py::test_config PASSED                                  [ 55%]
tests/test_projects.py::test_projects_page_unauthenticated PASSED        [ 59%]
tests/test_projects.py::test_projects_page_authenticated PASSED          [ 62%]
tests/test_projects.py::test_create_project PASSED                       [ 66%]
tests/test_projects.py::test_edit_project_unauthorized PASSED            [ 70%]
tests/test_projects.py::test_view_nonexistent_project PASSED             [ 74%]
tests/test_projects.py::test_create_project_invalid_data PASSED          [ 77%]
tests/test_projects.py::test_edit_project_get PASSED                     [ 81%]
tests/test_projects.py::test_edit_project_post PASSED                    [ 85%]
tests/test_projects.py::test_delete_project PASSED                       [ 88%]
tests/test_services.py::test_scoring_basic FAILED                        [ 92%]
tests/test_smoke.py::test_smoke PASSED                                   [ 96%]
tests/test_utils.py::test_format_datetime_filter PASSED                  [100%]

================================== FAILURES ===================================
_____________________________ test_scoring_basic ______________________________

session = <sqlalchemy.orm.scoping.scoped_session object at 0x0000010B69B220B0>
app = <Flask 'app'>, test_user = <User 19>

    def test_scoring_basic(session, app, test_user):
        """Test basic score calculation logic (relies on static DB population)."""
        print("\n--- Running test_scoring_basic ---")
    
        # Arrange: Create Project and Assessment only
        print("   Creating Project...")
        project = Project(name='Scoring Test Project', user_id=test_user.id)
        session.add(project)
        session.commit()  # Commit project to get ID
        print(f"   Committed Project (ID: {project.id})")
    
        print("   Creating Assessment...")
>       assessment = Assessment(project_id=project.id, user_id=test_user.id)
E       NameError: name 'Assessment' is not defined

tests\test_services.py:20: NameError
---------------------------- Captured stdout setup ----------------------------
   -> Providing db.session for test function.
     -> Creating test user object...
     <- Test user created and committed (ID: 19, Email: test_206e25f1@example.com).
---------------------------- Captured stdout call -----------------------------

--- Running test_scoring_basic ---
   Creating Project...
   Committed Project (ID: 11)
   Creating Assessment...
============================== warnings summary ===============================
app\models\__init__.py:15
  z:\sdg_assessment\app\models\__init__.py:15: SADeprecationWarning: User-placed attribute SdgGoal.source_rels on Mapper[SdgGoal(sdg_goals)] is replacing an existing ORM-mapped attribute.  Behavior is not fully defined in this case.  This use is deprecated and will raise an error in a future release
    SdgGoal.source_rels = db.relationship(

app\models\__init__.py:22
  z:\sdg_assessment\app\models\__init__.py:22: SADeprecationWarning: User-placed attribute SdgGoal.target_rels on Mapper[SdgGoal(sdg_goals)] is replacing an existing ORM-mapped attribute.  Behavior is not fully defined in this case.  This use is deprecated and will raise an error in a future release
    SdgGoal.target_rels = db.relationship(

tests/test_assessments.py::test_assessment_creation
  z:\sdg_assessment\app\routes\assessments.py:204: LegacyAPIWarning: The Query.get() method is considered legacy as of the 1.x series of SQLAlchemy and becomes a legacy construct in 2.0. The method is now available as Session.get() (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
    assessment = Assessment.query.get(assessment_id)

tests/test_assessments.py::test_accessing_results_page_directly
tests/test_assessments.py::test_assessment_submission_and_results
  z:\sdg_assessment\app\routes\assessments.py:394: LegacyAPIWarning: The Query.get() method is considered legacy as of the 1.x series of SQLAlchemy and becomes a legacy construct in 2.0. The method is now available as Session.get() (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
    assessment = Assessment.query.get(assessment_id)

tests/test_assessments.py::test_accessing_results_page_directly
tests/test_assessments.py::test_assessment_submission_and_results
  z:\sdg_assessment\app\routes\assessments.py:399: LegacyAPIWarning: The Query.get() method is considered legacy as of the 1.x series of SQLAlchemy and becomes a legacy construct in 2.0. The method is now available as Session.get() (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
    project = Project.query.get(assessment.project_id)

tests/test_assessments.py::test_assessment_submission_and_results
  z:\sdg_assessment\app\routes\assessments.py:566: LegacyAPIWarning: The Query.get() method is considered legacy as of the 1.x series of SQLAlchemy and becomes a legacy construct in 2.0. The method is now available as Session.get() (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
    assessment = Assessment.query.get(assessment_id)

tests/test_projects.py::test_view_nonexistent_project
tests/test_projects.py::test_edit_project_post
  Z:\sdg_assessment\venv\lib\site-packages\flask_sqlalchemy\query.py:30: LegacyAPIWarning: The Query.get() method is considered legacy as of the 1.x series of SQLAlchemy and becomes a legacy construct in 2.0. The method is now available as Session.get() (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
    rv = self.get(ident)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=============================== tests coverage ================================
_______________ coverage: platform win32, python 3.10.9-final-0 _______________

Name                                    Stmts   Miss  Cover   Missing
---------------------------------------------------------------------
app\__init__.py                           116     38    67%   17-18, 26, 29, 42, 65-90, 97, 110-113, 128-132
app\cli.py                                 24     24     0%   5-44
app\models\__init__.py                      9      0   100%
app\models\assessment.py                  113     63    44%   31, 58-83, 87-100, 104-132, 136-148, 152-172, 176-190, 214, 219-228, 232-259
app\models\project.py                      34     16    53%   26, 50-67, 71-79
app\models\questionnaire.py                21     21     0%   1-30
app\models\response.py                     15      1    93%   20
app\models\sdg.py                          29      0   100%
app\models\sdg_relationship.py              8      0   100%
app\models\user.py                         37     17    54%   21, 26-27, 32-41, 46-47, 52-61
app\routes\__init__.py                      7      0   100%
app\routes\api.py                         236    189    20%   21-43, 49-78, 84-115, 120-140, 146-159, 168-193, 200-217, 223-238, 243-249, 254-309, 314-325, 336-349, 355-434
app\routes\assessments.py                 484    332    31%   37-84, 93-124, 136-137, 158-179, 207-208, 218-257, 270-273, 280-324, 331-355, 365-384, 396-397, 401-402, 436, 445-449, 456-489, 496-516, 523-547, 562-564, 568-570, 588-592, 616-618, 629-630, 640, 656-662, 671-675, 690-699, 706-720, 725-798, 803-837
app\routes\assessments_cli.py              43     30    30%   10-14, 20-32, 38-53
app\routes\auth.py                        161    101    37%   20, 23, 30-33, 64-91, 96-118, 124-126, 132-138, 143-160, 165-197, 204-209, 216-237
app\routes\dashboard.py                   118     69    42%   18-27, 36-78, 95-108, 118-145, 157-195, 202-213, 223-234, 244-288, 303, 310-325, 336-348
app\routes\goals_cli.py                    25     17    32%   30-52
app\routes\main.py                         44     25    43%   9-24, 28-32, 38-294, 305, 309, 317
app\routes\projects.py                    108     31    71%   33, 65-70, 95-97, 104-125, 133-134, 141-143, 149
app\routes\questionnaire.py                 7      1    86%   9
app\services\__init__.py                    1      0   100%
app\services\assessment_service.py         39     39     0%   7-81
app\services\email.py                      26     26     0%   1-34
app\services\project_service.py            99     99     0%   1-133
app\services\scoring_service.py           209    170    19%   15, 24, 26, 28, 30, 32, 35, 37, 39, 46, 73-74, 84-227, 428-470, 484-540
app\utils\__init__.py                       0      0   100%
app\utils\auth.py                          21     14    33%   9-22
app\utils\context_processors.py            33     33     0%   5-51
app\utils\db.py                            19     12    37%   7-14, 18-21, 25-28, 32
app\utils\db_utils.py                      64     13    80%   32, 35-39, 70-71, 83-86, 91
app\utils\email.py                         30     28     7%   4-39
app\utils\email_confirmed_required.py      11      4    64%   8-11
app\utils\errors.py                        16     16     0%   6-31
app\utils\filters.py                       40     16    60%   14, 22, 26, 31-42, 47-50, 55, 58-59
app\utils\middleware.py                    27     27     0%   6-61
app\utils\print_db_overview.py             24     24     0%   1-29
app\utils\print_sdg_goals.py               15     15     0%   1-18
app\utils\print_sdg_questions.py           15     15     0%   1-20
app\utils\scoring.py                       43     43     0%   1-77
app\utils\sdg_data.py                       1      0   100%
app\utils\validation.py                   121    121     0%   6-221
---------------------------------------------------------------------
TOTAL                                    2493   1690    32%
=========================== short test summary info ===========================
FAILED tests/test_services.py::test_scoring_basic - NameError: name 'Assessme...
============ 1 failed, 20 passed, 6 skipped, 10 warnings in 6.71s =============
